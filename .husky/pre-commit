#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ› Entered Husky pre-commit hook"

# Move into the Nx workspace directory
cd Source/Windows/TeensyRom.Ui/src/TeensyRom.Api/ClientApp/teensyrom-nx || {
  echo "âŒ Failed to cd into Nx workspace directory"
  exit 1
}

# Use pnpm for pnpm workspace
echo "âœ… Running lint-staged with pnpm dlx"
pnpm dlx lint-staged || exit 1

# Run unit tests (block commit if they fail)
echo "ğŸ§ª Running Tests..."
if command -v pnpm >/dev/null 2>&1; then
  pnpm dlx nx run-many --target=test --all --watch=false --parallel=false || {
    echo "âŒ Unit tests failed. Commit aborted."
    exit 1
  }
else
  npx nx run-many --target=test --all --watch=false --parallel=false || {
    echo "âŒ Unit tests failed. Commit aborted."
    exit 1
  }
fi