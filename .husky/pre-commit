#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ› Entered Husky pre-commit hook"

# Move into the web project directory where eslint.config.js lives
cd Source/Windows/TeensyRom.Ui/src/TeensyRom.Api/ClientApp/teensyrom-ui || {
  echo "âŒ Failed to cd into UI directory"
  exit 1
}

# Only try to run lint-staged if npx can actually be invoked
if command -v npx >/dev/null 2>&1 && npx --version >/dev/null 2>&1; then
  echo "âœ… Running lint-staged with working npx"
  npx lint-staged || exit 1
else
  echo "âš ï¸  Skipping lint-staged â€” npx not available or broken in this environment"
  echo "â„¹ï¸  Youâ€™re probably committing from Visual Studioâ€™s built-in Git, which lacks full environment support"
fi

# Run unit tests (block commit if they fail)
echo "ğŸ§ª Running unit tests..."
npx ng test --configuration=ci --watch=false || {
  echo "âŒ Unit tests failed. Commit aborted."
  exit 1
}